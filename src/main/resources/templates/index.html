<!DOCTYPE html>
<html th:replace="~{fragments/layout :: layout('–ü–æ—á–µ—Ç–Ω–∞', ~{::.main-container})}" xmlns:th="http://www.thymeleaf.org" lang="sr">
<head/>
<body>
<div class="main-container">

    <!-- ‚¨ÜÔ∏è –ò–∑–±–æ—Ä –¥–µ—Ç–µ—Ç–∞ -->
    <form method="get" action="/web/index">
        <div style="
            margin-top:0.5rem;
            margin-bottom:0.5rem;
            padding:1rem;
            background:#f0f4ff;
            border:1px solid #ccc;
            border-radius:8px;
            display:flex;
            align-items:center;
            gap:1rem;
            font-size:1.2rem;">
            <label for="childId" style="font-weight:bold;">üë§ –ò–∑–∞–±–µ—Ä–∏ –¥–µ—Ç–µ:</label>
            <select name="childId" id="childId" style="
                font-size:1.1rem;
                padding:0.4rem 0.6rem;
                border-radius:6px;
                border:1px solid #aaa;
                background:white;">
                <option th:each="child : ${children}"
                        th:value="${child.id}"
                        th:text="${child.name}"
                        th:selected="${child.id == selectedChildId}">
                </option>
            </select>
            <button type="submit" style="
                font-size:1rem;
                padding:0.5rem 1rem;
                background:#001f4d;
                color:white;
                border:none;
                border-radius:6px;
                cursor:pointer;">–ü—Ä–∏–∫–∞–∂–∏</button>
        </div>
    </form>

    <!-- üìä –û—Å–Ω–æ–≤–Ω–∏ –ø–æ–¥–∞—Ü–∏ —É —Ç—Ä–∏ –∫–æ–ª–æ–Ω–µ -->
    <div style="
        margin:0.5rem 0;
        background:#f0f4ff;
        padding:1rem;
        border:1px solid #ccc;
        border-radius:8px;
        display:flex;
        justify-content:space-between;
        flex-wrap:wrap;
        gap:1rem;">
        <!-- üí∞ –¢—Ä–µ–Ω—É—Ç–Ω–æ —Å—Ç–∞—ö–µ -->
        <div style="
            flex:1;
            min-width:220px;
            display:flex;
            flex-direction:column;
            justify-content:center;
            align-items:center;
            text-align:center;">
            <h2 style="margin:0; font-size:1.6rem;">üí∞ –¢—Ä–µ–Ω—É—Ç–Ω–æ —Å—Ç–∞—ö–µ</h2>
            <p style="font-size:2rem; font-weight:bold; margin-top:0.5rem; margin-bottom:0;">
                <span th:text="${(startingBalance ?: 0) + (totalAllowance ?: 0) + (totalRewards ?: 0) - (totalPenalties ?: 0) + (totalGifts ?: 0)} + ' –¥–∏–Ω.'"></span>
            </p>
        </div>

        <!-- üìå –§–∏–Ω–∞–Ω—Å–∏—ò—Å–∫–∏ –æ–∫–≤–∏—Ä -->
        <div style="flex:1; min-width:220px;">
            <h3 style="margin-top:0;">üìå –§–∏–Ω–∞–Ω—Å–∏—ò—Å–∫–∏ –æ–∫–≤–∏—Ä</h3>
            <ul style="list-style:none; padding:0; font-size:1.1rem;">
                <li>–ù–µ–¥–µ—ô–Ω–∏ —ü–µ–ø–∞—Ä–∞—Ü: <strong th:text="${allowanceBase} + ' –¥–∏–Ω.'"></strong></li>
                <li>–ü–æ—á–µ—Ç–Ω–æ —Å—Ç–∞—ö–µ: <strong th:text="${startingBalance} + ' –¥–∏–Ω.'"></strong></li>
                <li>–£–∫—É–ø–∞–Ω —ü–µ–ø–∞—Ä–∞—Ü: <strong th:text="${totalAllowance} + ' –¥–∏–Ω.'"></strong></li>
            </ul>
        </div>

        <!-- üéÅ –ü–æ–¥—Å—Ç–∏—Ü–∞—ò–∏ –∏ –∫–æ—Ä–µ–∫—Ü–∏—ò–µ -->
        <div style="flex:1; min-width:220px;">
            <h3 style="margin-top:0;">üéÅ –ü–æ–¥—Å—Ç–∏—Ü–∞—ò–∏ –∏ –∫–æ—Ä–µ–∫—Ü–∏—ò–µ</h3>
            <ul style="list-style:none; padding:0; font-size:1.1rem;">
                <li>–ù–∞–≥—Ä–∞–¥–µ: <strong th:text="${totalRewards} + ' –¥–∏–Ω.'"></strong></li>
                <li>–ö–∞–∑–Ω–µ: <strong th:text="${totalPenalties} + ' –¥–∏–Ω.'"></strong></li>
                <li>–ü–æ–∫–ª–æ–Ω–∏ –∏ –±–æ–Ω—É—Å–∏: <strong th:text="${totalGifts} + ' –¥–∏–Ω.'"></strong></li>
            </ul>
        </div>
    </div>

    <!-- üìÖ –ú–∞—Ç—Ä–∏—Ü–∞ –æ—Ü–µ–Ω–∞ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏–º–∞ -->
    <div style="overflow:auto; max-height:30rem; border:2px solid #aaa;">
        <table style="
            border-collapse:collapse;
            background:#e6ffe6;
            font-size:0.8rem;
            text-align:center;
            width:max-content;
            min-width:100%;">
            <thead>
            <tr style="background:#cceccc;">
                <th style="border:1px solid #aaa; min-width:12rem; position:sticky; left:0; background:#cceccc; z-index:2;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç</th>
                <th style="border:1px solid #aaa; min-width:16rem; position:sticky; left:12rem; background:#cceccc; z-index:2;">–û–ø–∏—Å</th>
                <th style="border:1px solid #aaa; min-width:6rem; position:sticky; left:28rem; background:#cceccc; z-index:2;">–ú–∞–∫—Å.</th>
                <th th:each="weekNum : ${#numbers.sequence(1,52)}"
                    th:text="'–ù' + weekNum"
                    style="border:1px solid #aaa; min-width:6rem;">
                </th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="row : ${scoreMatrix}">
                <td style="border:1px solid #aaa; text-align:left; min-width:12rem; position:sticky; left:0; background:#f8fff8;" th:text="${row.activity.name}"></td>
                <td style="border:1px solid #aaa; text-align:left; min-width:16rem; position:sticky; left:12rem; background:#f8fff8;" th:text="${row.activity.description}"></td>
                <td style="border:1px solid #aaa; min-width:6rem; position:sticky; left:28rem; background:#f8fff8;" th:text="${row.activity.maxScore}"></td>
                <td th:each="score : ${row.weeklyScores}"
                    style="border:1px solid #aaa; min-width:6rem;"
                    th:text="${score.score}">
                </td>
            </tr>
            </tbody>
        </table>
    </div>

</div>
</body>
</html>